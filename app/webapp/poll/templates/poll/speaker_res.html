{# base.htmlを継承 #}
{% extends 'base.html' %}

{# タイトルを変更 #}
{% block title %}Results{% endblock %}

{# メインコンテンツ #}
{% block content %}
    <div class="container-head" style="color: #19C5FF">
        <h1>Listener's Voices</h1>
    </div>

    <div class="container-group-graph">
        <a href="{% url 'poll:index' %}" class="btn btn-outline-secondary btn-lg">
            Homeに戻る
        </a>

        {# スライド数のグラフをバインドする要素の準備 #}
        <div class="container-graph">
            {% for i in slide_list %}
                <h3 style="text-align: center">{{ i }}</h3>
                <div id={{ i }}></div>
            {% endfor %}
        </div>
    </div>

    {# コメント一覧表 #}
    <div class="container-table">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th scope="col" class="text-center" style="width: 5%">スライド</th>
                <th scope="col" class="text-center" style="width: 10%">時刻</th>
                <th scope="col" class="text-center" style="width: 35%;">内容</th>
            </tr>
            </thead>
            <tbody>
            {% for comment in comment_dic_list %}
                <tr>
                    <td class="text-right">{{ comment.slide }}</td>
                    <td class="text-right">{{ comment.time }}</td>
                    <td class="text-left">{{ comment.text }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="container-home">
        <a href="{% url 'poll:index' %}" class="btn btn-outline-secondary btn-lg">
            Homeに戻る
        </a>
    </div>

    <script>
        let datax = [];
        let data1 = [];
        let data2 = [];
        let data3 = [];

        let data_var = [];
        let counter = 0;

        {# x軸データ #}
        {% for list in time_list %}
            counter = {{ forloop.counter0 }};
            data_var[counter] = [];
            {% for v in list %}
                data_var[counter].push('{{ v }}');
            {% endfor %}
            datax.push(data_var[counter]);
        {% endfor %}

        {# 分かったデータ #}
        {% for list in data1_list %}
            counter = {{ forloop.counter0 }};
            data_var[counter] = [];
            {% for v in list %}
                data_var[counter].push('{{ v }}');
            {% endfor %}
            data1.push(data_var[counter]);
        {% endfor %}

        {# もう知ってるデータ #}
        {% for list in data2_list %}
            counter = {{ forloop.counter0 }};
            data_var[counter] = [];
            {% for v in list %}
                data_var[counter].push('{{ v }}');
            {% endfor %}
            data2.push(data_var[counter]);
        {% endfor %}

        {# 分からないデータ #}
        {% for list in data3_list %}
            counter = {{ forloop.counter0 }};
            data_var[counter] = [];
            {% for v in list %}
                data_var[counter].push('{{ v }}');
            {% endfor %}
            data3.push(data_var[counter]);
        {% endfor %}

        {# 折れ線グラフ作成 #}
        for (let i = 0; i < {{ slide_num }}; i++) {
            c3.generate({
                bindto: "#slide_" + (i + 1),
                padding: {
                    right: 20
                },
                data: {
                    x: 'x',
                    xFormat: '%H:%M:%S',
                    columns: [
                        datax[i],
                        data1[i],
                        data2[i],
                        data3[i]
                    ]
                },
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: '%H:%M:%S'
                        }
                    }
                },
            });
        }
    </script>
{% endblock %}
